---
layout: post
title: Migrating My Data From Parse
date: 2016-03-31 09:34:25.000000000 +03:00
type: post
parent_id: '0'
published: false
password: ''
status: publish
categories:
- Sem categoria
tags: []
meta:
  _wpcom_is_markdown: '1'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '21306330621'
author:
  login: natanrolnik
  email: natanrolnik@gmail.com
  display_name: natanrolnik
  first_name: ''
  last_name: ''
---
<p style="text-align:justify;"><span style="font-weight:400;">As you probably already know, Parse announced it’s ending their hosting services on January 28, 2017. The migration plan was </span><a href="https://github.com/ParsePlatform/parse-server/wiki/Migrating-an-Existing-Parse-App" target="_blank"><span style="font-weight:400;">divided in two steps</span></a><span style="font-weight:400;">: first, we need to host the databases of our apps, and later on we should deploy our own, open source, Parse Server. During the first stage, the clients (iOS, Android, etc.) will keep hitting Parse’s servers, and they will access the newly migrated data; after the second stage is done and your server is up and running, the clients should be updated to point to the new server. The recommended schedule by the Parse team is to migrate the database by April 28, and finish setting up your self-hosted Parse Server by July 28. Yes, you read it right - if you haven’t migrated your database, </span><a href="https://github.com/ParsePlatform/parse-server/wiki/Migrating-an-Existing-Parse-App#what-happens-if-i-dont-migrate-my-data-by-april-28-2016" target="_blank"><span style="font-weight:400;">you have less than a month to do so</span></a><span style="font-weight:400;">.</span></p>
<p style="text-align:justify;"><span style="font-weight:400;">“</span><i><span style="font-weight:400;">But where should I start from?</span></i><span style="font-weight:400;">”, you may ask. As any decision, the pros and cons must to be taken into account, also considering the different conditions: do you have only one or multiple apps on Parse? They store huge amounts of data, or not so much? Do you have experience managing databases, specially MongoDB? How sensitive is your data? What is your budget? </span></p>
<p style="text-align:justify;"><span style="font-weight:400;">As most of my apps have a small, niche audience, the amounts of data are really small. None of the databases is higher than 10 MB, even with a few thousand users, installation, and other objects. Also, most of them are free, with some humble contributions or donations occasionally. Therefore, I have a small budget to keep them functioning. As I have zero experience managing databases, I can’t build all the MongoDB server by myself (for example, I didn’t even know of some concepts like sharding, replica sets, and more). I started researching all the different options available in the market, to find what would fit my needs.</span></p>
<h2 style="text-align:justify;">Ok, so what are my options now?</h2>
<p style="text-align:justify;"><span style="font-weight:400;">Suggested by the Parse Team, there are </span><a href="http://docs.mlab.com/migrating-from-parse/" target="_blank"><span style="font-weight:400;">mLab</span></a><span style="font-weight:400;"> and </span><a href="https://objectrocket.com/parse" target="_blank"><span style="font-weight:400;">ObjectRocket</span></a><span style="font-weight:400;">, who provide - from what I’ve read - excellent DB-as-a-service. mLab would be a good fit for me, their prices start from U$15 per GB/database/month (the free tier is not intended for production usage). I have around 6 apps in production, and they require different databases, so the monthly cost would be almost U$100 per month, and we aren’t even talking about hosting the Parse Server yet. (Actually, if you are using only Parse Server, and not migrating from hosted Parse, you can use only one database for different apps, by defining a </span><a href="https://github.com/ParsePlatform/parse-server/blob/ef08dcf76cb91131ff63dfbdba67a65ccf75b557/src/ParseServer.js#L70" target="_blank"><span style="font-weight:400;">collectionPrefix</span></a><span style="font-weight:400;">).</span></p>
<p style="text-align:justify;"><span style="font-weight:400;">Unfortunately, the prices and sizes that ObjectRocket offer aren’t for indie/side projects, so I needed to cross them as well from my list, together with mLab and </span><a href="https://compose.io/" target="_blank"><span style="font-weight:400;">Compose.io</span></a><span style="font-weight:400;">. While reading the </span><a href="https://github.com/ParsePlatform/parse-server/wiki#community-links" target="_blank"><span style="font-weight:400;">community links</span></a><span style="font-weight:400;"> and googling more, I’ve found </span><a href="https://www.clever-cloud.com/" target="_blank"><span style="font-weight:400;">Clever Cloud</span></a><span style="font-weight:400;">. I almost chose them to host my DBs: you can host as many mongo dbs you want, and it’s free up to 500 MB; but if you need more than that, it jumps from a free 500 MB, to a 75 €/month for 30 GB, and I needed something in the middle.</span></p>
<p style="text-align:justify;"><span style="font-weight:400;">Also, as an option for a replacement of all Parse services, there are also </span><a href="http://nodechef.com/parse-server" target="_blank"><span style="font-weight:400;">NodeChef</span></a><span style="font-weight:400;">, </span><a href="http://www.parseground.com/" target="_blank"><span style="font-weight:400;">ParseGround</span></a><span style="font-weight:400;">, </span><a href="https://www.backand.com/parse-alternative/" target="_blank"><span style="font-weight:400;">Backand</span></a><span style="font-weight:400;"> and </span><a href="http://blog.back4app.com/2016/03/01/quick-wizard-migration/" target="_blank"><span style="font-weight:400;">Back4app</span></a><span style="font-weight:400;">. But as now I have the possibility to have control over the whole parse stack, I preferred not to depend too much again on another service. It’s a personal decision; check them out because they may be a good fit for you, if you don’t want to worry at all with the backend.</span></p>
<p style="text-align:justify;"><span style="font-weight:400;">After a few weeks, when I was about to give up, I found </span><a href="https://scalegrid.io" target="_blank"><span style="font-weight:400;">Scalegrid.io</span></a><span style="font-weight:400;">, that provided exactly what I needed: a place where I can create many Mongo DBs under the same infrastructure (a cluster). Someone to manage the hard part, but with the control that I want. Similarly, there is also </span><a href="https://www.mongodb.com/migrate-from-parse-to-mongodb-cloud-manager-and-aws" target="_blank"><span style="font-weight:400;">MongoDB Cloud Manager</span></a><span style="font-weight:400;">, which is an excellent product from MongoDB Inc. itself. I preferred to go with Scalegrid, but the process I describe in the next section is very similar for both solutions.</span></p>
<h2 style="text-align:justify;">Setting up my first MongoDB server</h2>
<p style="text-align:justify;"><span style="font-weight:400;">After signing up for a 30 day free trial, I checked which one of the services would fit me better: (1) hosting, where I provide my AWS keys or own hardware, and they manage it, or (2) management, where I don’t need to worry about the hardware that will host the dbs. In my case, I preferred to have control also over the underlying instances, so I chose the first option. Price-wise, they are very similar at the end of the day - in the first, you need to pay AWS and Scalegrid.io, while in the second you pay a little more but only for Scalegrid.io. According to my calculations, it would be something very close. So this is what I did, and what you should do to set it up:</span></p>
<ol style="text-align:justify;">
<li style="font-weight:400;"><span style="font-weight:400;">Create a new user the AWS account and generate the keys (Acces Key Id and Secret Acces Key). Remember to save this keys, as you won’t get them again from AWS.</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">Created a new “Cloud Profile” in the Scalegrid console using the AWS keys.</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">Created a new cluster using this profile. It means that the AWS EC2 instances will be created, by Scalegrid, in your AWS account. Bear in mind that you will need to choose a few options:</span>
<ol>
<li style="font-weight:400;"><span style="font-weight:400;">Size (micro gives you 10GB of storage);</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">The version of Mongo (Parse only supports officially 2.6 and 3.0 for now);</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">To enable </span><a href="https://docs.mongodb.org/manual/core/replication-introduction/" target="_blank"><span style="font-weight:400;">replica sets</span></a><span style="font-weight:400;"> and </span><a href="https://docs.mongodb.org/manual/core/sharding-introduction/" target="_blank"><span style="font-weight:400;">sharding</span></a><span style="font-weight:400;"> - if you don’t have high traffic and don’t need redundancy, you probably don’t need;</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">To encrypt and compress the data - I suggest to set both to yes;</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">To enable SSL (more on the last paragraph) - it’s recommended, but not required.</span></li>
</ol>
</li>
<li style="font-weight:400;"><span style="font-weight:400;">Wait for a few minutes (you can see the instance being created in the AWS console), and your cluster will be ready to go.</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">Now you should be able to get the connection string, needed for migrating your Parse apps, but we are almost done.</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">For each app, you will need a new database in your cluster. So for each app you have:</span>
<ol>
<li style="font-weight:400;"><span style="font-weight:400;">Create a new database </span></li>
<li style="font-weight:400;"><span style="font-weight:400;">add a user (I called mine </span><i><span style="font-weight:400;">parse-access</span></i><span style="font-weight:400;">) and set a password</span></li>
</ol>
</li>
<li style="font-weight:400;"><span style="font-weight:400;">Get the connection string, and append the database name at the end. For example, if the database name is SuperApp, your connection string should be: </span><span style="font-weight:400;">mongodb://user</span><b>:</b><span style="font-weight:400;">password@hostaddress</span><b>:</b><span style="font-weight:400;">port/SuperApp.</span><span style="font-weight:400;"> (the default port is 27017, and remember to append </span><i><span style="font-weight:400;">?ssl=true </span></i><span style="font-weight:400;">at the end).</span></li>
</ol>
<p style="text-align:justify;"><span style="font-weight:400;">Finally, an important detail: as one of my apps stores medical data, I wanted SSL to be required. Scalegrid offers two options: </span><a href="https://scalegrid.io/blog/mongodb-ssl-with-self-signed-certificates-in-node-js/" target="_blank"><span style="font-weight:400;">self-signed certificates</span></a><span style="font-weight:400;">, or use your own, trusted certificates. If you are running only your own Parse Server, the self-signed certificate is enough; if you are migrating from Parse, you will need to get a certificate from a trusted Certificate Authority, or disable SSL at all in your mongo server. I chose the first option:</span></p>
<ol style="text-align:justify;">
<li style="font-weight:400;"><span style="font-weight:400;">Purchase a certificate for a subdomain that you own:</span>
<ol>
<li style="font-weight:400;"><span style="font-weight:400;">You can get a wildcard certificate, for more than one subdomain, or get a certificate for a specific subdomain. (The latter is cheaper and may be enough, so that’s what I did: a $10 certificate via Namecheap/Comodo);</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">In order to create the certificate, you will need to create a .csr file. Use ssh to connect to the AWS instance and </span><a href="https://support.comodo.com/index.php?/Default/Knowledgebase/Article/View/1/19/csr-generation-using-openssl-apache-wmod_ssl-nginx-os-x" target="_blank"><span style="font-weight:400;">create the .csr</span></a><span style="font-weight:400;">;</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">Provide the .csr file to the Certificate Authority;</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">Prove that you own the domain (this can be done by e-mail @yourdomain, or using DNS records).</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">In a few minutes you should receive the certificate files.</span></li>
</ol>
</li>
<li style="font-weight:400;"><span style="font-weight:400;">In your DNS records, make the certified subdomain point to the Scalegrid server</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">Finally, </span><a href="https://scalegrid.io/blog/bring-your-own-ssl-certificates/" target="_blank">install the certificate</a><span style="font-weight:400;"> in the mongo server. (the great Scalegrid support team helped me doing so)</span></li>
<li style="font-weight:400;"><span style="font-weight:400;">When I thought the SSL journey was over, the migration tool from Parse still wasn’t reaching the servers, showing “No reachable servers”, because the setup wasn’t complete. After researching for a few hours, I discovered that we forgot to add the </span><a href="https://uk.godaddy.com/help/what-is-an-intermediate-certificate-868" target="_blank"><span style="font-weight:400;">intermediate certificate</span></a><span style="font-weight:400;">.</span></li>
</ol>
<h4 style="text-align:center;"><span style="font-weight:400;">I’m very happy with the solution I’ve found, but my advice to you is: </span><b>study</b><span style="font-weight:400;"> the available options</span><b>, define</b><span style="font-weight:400;"> your priorities and budget,</span><b> and start the migration process</b><span style="font-weight:400;"> once you chose how to store your data. Be prepared and don’t leave it to the last minute!</span></h4>
<p><img class=" size-full wp-image-495 aligncenter" src="{{ site.baseurl }}/assets/unknown-2.jpeg" alt="Unknown-2.jpeg" width="500" height="333" /></p>
<p>If you have any troubles, you can ping me <a href="https://www.twitter.com/natanrolnik" target="_blank">@natanrolnik</a>, or e-mail: <em>me at natanrolnik.me</em><br />
Thanks to <a href="https://www.twitter.com/newFosco" target="_blank">@newFosco</a>, <a href="https://www.twitter.com/MarcioK" target="_blank">@MarcioK</a> and <a href="https://www.twitter.com/ofermorag24" target="_blank">@ofermorag24</a>  for reviewing this post</p>
